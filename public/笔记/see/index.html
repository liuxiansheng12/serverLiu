<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>笔记列表</title>

    <style>
        .roots {
            width: 1200px;
            margin: 0 auto;
            border: 2px solid #f4f4f4;
            margin-top: 40px;
            padding-top: 10px;
            padding-left: 10px;
            padding-bottom: 10px;
        }
        .margin-1 {
            margin-left: 10px;
        }
        .margin-2 {
            margin-left: 20px;
        }
        .margin-3 {
            margin-left: 30px;
        }
        .margin-4 {
            margin-left: 40px;
        }
        .margin-5 {
            margin-left: 50px;
        }
        .margin-6 {
            margin-left: 60px;
        }
        .margin {
            padding: 6px 0;
            cursor: pointer;
        }
        .cu {
            font-size: 18px;
            font-weight: 700;
        }
        .cus {
            font-size: 22px;
            font-weight: 700;
        }

        .dingji {
            padding: 20px;
            border: 2px solid #f4f4f4;
            margin-top: 20px;
            display: flex;
        }
        .texts {
            margin-right: 10px;
            flex: 0 0 auto;
            line-height: 36px;
            min-width: 150px;
        }

        .dingji-2 div,
        .dingji-1 div {
            display: inline-block;
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="dingji">
        <div class="texts">前端知识点：</div>
        <div class="dingji-1"></div>
    </div>
    <div class="dingji">
        <div class="texts">后端Java知识点：</div>
        <div class="dingji-2"></div>
    </div>
    <div class="root">

    </div>
    <script>

        const map = new Map();
        async function getData() {
            const d = await fetch("/noteProc/getFilePaths")
            const data = await d.json();
            for(let i = 0; i < data.result.length; i ++) {
                const d = data.result[i];
                if(d.path === "前端笔记" || d.path === "后端Java笔记") {
                    map.set(d.path, chuLi(d.childrenPath));
                }
            }
            xuanRan(map);
        }
        function sort(data) {
            for(let i = 0; i < data.length; i ++) {
                let a = 0;
                if(data[i].path) a = parseInt(data[i].path);
                else a = parseInt(data[i]);

                for(let j = i + 1; j < data.length; j ++) {
                    let b = 0;
                    if(data[j].path) b = parseInt(data[j].path);
                    else b = parseInt(data[j]);

                    if(a > b) {
                        const lin = data[j];
                        data[j] = data[i];
                        data[i] = lin;
                        a = b;
                    }
                } 
            }
        }
        function chuLi(data) {
            const arr = [];
            const wenJian = [];
            for(let i = 0; i < data.length; i ++) {
                if(data[i].childrenPath && data[i].childrenPath.length > 0) {
                    const obj = {};
                    obj["path"] = data[i].path;
                    obj["childrenPath"] = chuLi(data[i].childrenPath);
                    wenJian.push(obj);
                }
                else {
                    arr.push(data[i].path);
                }
            }
            sort(wenJian);
            sort(arr);
            return [...arr, ...wenJian];
        }

        getData();

        function xuanRan(data) {
            const qian = data.get("前端笔记");
            
            if(qian) {
                createDoms(qian, "前端笔记", "前端笔记");
            }
            
            const houJava = data.get("后端Java笔记");
            if(houJava) {
                createDoms(houJava, "后端Java笔记", "后端Java笔记");
            }
        }


        function createDoms(data, url, name) {
            let str = document.createElement('div');
            str.style.marginTop = "30px";
            str.className = "roots";

            let dom = document.createElement('div');
            dom.innerHTML = name;
            dom.className = "cus";
            str.appendChild(dom);

            let doms = null;
            if(name === "前端笔记") {
                doms = document.querySelector(".dingji-1");
            }
            else if(name === "后端Java笔记") {
                doms = document.querySelector(".dingji-2");
            }

            str.appendChild(createDome(data, 1, url, doms));
            document.querySelector(".root").appendChild(str);
        }

        function createDome(data, h, url, doms) {
            let str = document.createElement('div');
            for(let i = 0; i < data.length; i ++) {
                if(data[i].childrenPath) {
                    let dom = document.createElement('div');
                    dom.className = `margin ${"margin-" + h}`;
                    dom.innerHTML = data[i].path;
                    if(h === 1) dom.className += " cu";
                    str.appendChild(dom);
                    dom.onclick = () => {
                        document.querySelector(".root").innerHTML = "";
                        createDoms(data[i].childrenPath, url + "/" + data[i].path, data[i].path);
                    }

                    if(doms) {
                        let dom = document.createElement('div');
                        dom.className = `margin ${"margin-" + h}`;
                        dom.innerHTML = data[i].path;
                        if(h === 1) dom.className += " cu";
                        doms.appendChild(dom);

                        dom.onclick = () => {
                            document.querySelector(".root").innerHTML = "";
                            createDoms(data[i].childrenPath, url + "/" + data[i].path, data[i].path);
                        }
                    }

                    str.appendChild(createDome(data[i].childrenPath, h + 1, url + "/" + data[i].path));
                }
                else {
                    let dom = document.createElement('div');
                    dom.className = `margin ${"margin-" + h}`;
                    dom.innerHTML = data[i];
                    if(h === 1) dom.className += " cu";
                    dom.onclick = () => {
                        location.href = "/笔记/" + url + "/" + data[i];
                    }
                    str.appendChild(dom);
                }
            }
            return str;
        }

    </script>
</body>
</html>